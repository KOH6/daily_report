## はじめに

【Next.js13】最新バージョンの Next.js13 をマイクロブログ構築しながら基礎と本質を学ぶ講座

## 学んだこと

### Next.js の基礎と Next.js12 と Next.js13 の違いを理解しよう

- React はページ数が少ない小規模なウェブサイト開発に向いている。いわゆる SPA でページ遷移しないようなもの
- 最初に全部読み込むので、読み込み速度が遅い。ページ数が多い大規模ウェブサイトでは不利。
  - 読み込み速度が 1s 遅くなるとユーザの離脱率が上がる。
- **この問題点を補いたい →Next.js の登場**
- Next.js では最初から HTML が構成されている状態でレンダリングされる。クライアントのスペックに依存せず初期描画できる。（プリレンダリング）
  - SEO 対策にも有利。Google のクローラーの滞在時間が伸びる → 有益なサイトと判断され検索上位に出てきやすくなる。
- React は CSR（クライアントサイドレンダリング）、Next は SSG、SSR、ISR でサーバーサイドレンダリング
  - クライアントでレンダリングするメリットは初期描画さえ終えれば、**以降のページ遷移が速い**こと。
- Next を使うメリット
  - クライアント PC に依存しないレンダリング
  - ルーティング設計が直感的
  - ページ読み込み速度の向上
  - SEO 対策
  - API エンドポイント設計もできる

#### SSG, SSR, ISR

- SSG(Static Site Generator)
  - アプリケーションのビルド時にすでにページを構成してしまう。動的な値も API 叩いてこの時点で描画してしまうので、更新の少ないページで適用する。
  - ブログ、ドキュメント、商品ページ（更新が少ない場合）
- SSR(Server Side Rendering)
  - クライアントからリクエストがあったら、サーバー側で API も叩いてプリレンダリングが終わった HTML をクライアントに返す。更新の多いページはこっち。
  - SNS のタイムライン、ユーザプロフィール
- SSG、SSR はページ単位で切り替えることができる。アプリケーション全部 SSG とかにする必要はない、ということ。
- ISR(Incretemntal Static Regeneration)
  - 簡単に言うと、SSG と SSR の中間
  - アクセスが多いものを CDN にキャッシュして描画する。サーバーまで問い合わせをしないで描画できるので、SSR より速い。
    - CDN サーバーはデータ本体のサーバーより物理的に近い距離にあるサーバー。日本なら、東京にあるサーバー等。
  - ブログの詳細ページのような、更新頻度高いわけじゃないけど多少更新もしたいページで使われる。
    - キャッシュできる時間を 60s 等で設定できる。(revalidate)キャッシュ時間中に更新した場合は、設定時間経過後＆次のリクエストから新たな情報で描画される。
    - **60s 間隔で再ビルドする SSG **のような感じ！

### Next.js13 の開発環境を構築しよう

- 各ページに`use client`を記述すれば、クライアントサイドレンダリングになる。デフォルトではサーバーサイドレンダリング。
- Next ではディレクトリ構成がそのままルーティングになる。

### Next.js13 でマイクロブログを構築

- `unsplash`というサイトに無料の画像が多くある
- サーバーサイドレンダリングをするので、React の`useEffect, useState`のようなクライアントでの描画処理は`'user client'`にしないと基本的に書けなくなる。
- `notFound`や`error`ページへの遷移は Next が予め関数を用意してくれている。
